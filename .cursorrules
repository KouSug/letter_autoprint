# 封筒宛名印刷アプリ プロジェクトガイドライン

このドキュメントは、本プロジェクトの設計思想、技術スタック、およびこれまでの開発履歴をまとめたものです。

## 1. プロジェクト概要
Excelデータ（住所録）を読み込み、封筒（主に長形3号）に宛名を差し込み印刷するためのデスクトップ・ウェブアプリケーションです。
高級感のあるダークモード寄りのデザインと、直感的な位置調整・フォント設定機能を特徴としています。

## 2. 技術スタック
- **Frontend**: React (TypeScript), Vite
- **Styling**: Tailwind CSS, CSS Variables, Glassmorphism
- **Icons**: Lucide React
- **Animation**: Framer Motion
- **Libraries**: 
  - `xlsx`: Excelファイルのパース
  - `Local Font Access API`: PC内フォントの利用 (Chrome/Edge推奨)

## 3. 主要機能
- **Excelインポート**: `.xlsx`, `.xls` ファイルの読み込みと自動マッピング。
- **フィールドマッピング**: Excelの列を「郵便番号」「住所1」「住所2」「氏名」にユーザーが紐付け。
- **ライブプレビュー**: 
  - 項目ごとのドラッグ＆ドロップによる位置調整。
  - 数値入力による0.1mm単位の微調整。
  - 特定のレコード番号を直接入力してジャンプできるナビゲーション機能。
- **フォントカスタマイズ**:
  - 項目別（宛名、住所、郵便番号）のフォント選定。
  - PC内にインストールされているローカルフォントの読み込みと適用。
  - フォントサイズの大幅な調整（最大120px）。
  - 郵便番号の文字間隔（字詰め）を0.1mm単位で調整し、右揃えで配置する機能。
- **自動変換ロジック**:
  - 住所内のハイフン（-）を、縦書きでも適切に回転する長音記号（ー）へ自動変換。
- **履歴管理**: 10段階以上のUndo/Reset機能。
- **印刷制御**:
  - CSS `@media print` による正確なサイズ（120mm x 235mm）での出力。
  - 印刷対象の個別選択・一括選択。

## 4. UI/UX設計のこだわり
- **Glassmorphism**: 半透明のカードデザインを採用し、プレミアムな質感を演出。
- **コンテキストメニュー**: プレビュー上の各項目をクリックすることで、その場でフォントや間隔の設定が可能。
- **統合ツールバー**: プレビュー画面上部に「対象選択」「元に戻す」「リセット」を配置。
- **直感的なナビゲーション**: ページ番号を白地の数値入力欄にし、視認性と操作性を向上。

## 5. 開発履歴の要点
1. **初期構築**: Vite + React で基本の印刷ロジックを実装。
2. **デザイン強化**: ダークテーマとGlassmorphismの導入。
3. **ローカルフォント対応**: `queryLocalFonts` を用いたPCフォント利用機能の追加。
4. **操作性改善**: ドラッグ調整、Undo機能、統合ツールバーの導入。
5. **微調整フェーズ**: 宛名上限拡大、マッピング改善、コントラスト調整。
6. **機能洗練フェーズ（最新）**:
   - 住所ハイフンの縦書き最適化（三の字対策としての長音置換）。
   - レコード番号の直接入力ジャンプ機能の実装とUI改善（白地背景）。
   - 郵便番号の文字間隔調整スライダーの導入（設定パネルおよびコンテキストメニュー）。
   - 郵便番号の右揃え配置対応。
   - プレビュー画面からの不要なガイド枠（赤枠）の削除。

## 6. 今後の課題・注意点
- **ブラウザ制限**: ローカルフォントの取得には、起動ごとに最低一度のユーザーアクション（クリック）が必要。
- **レイアウトの柔軟性**: 特殊な封筒サイズへの対応拡大。
- **データ保存**: 設定（フォントや位置）のブラウザ保存（localStorageなど）。
